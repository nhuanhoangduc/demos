<!-- 
/*
 * 
 *                  xxxxxxx      xxxxxxx
 *                   x:::::x    x:::::x 
 *                    x:::::x  x:::::x  
 *                     x:::::xx:::::x   
 *                      x::::::::::x    
 *                       x::::::::x     
 *                       x::::::::x     
 *                      x::::::::::x    
 *                     x:::::xx:::::x   
 *                    x:::::x  x:::::x  
 *                   x:::::x    x:::::x 
 *              THE xxxxxxx      xxxxxxx TOOLKIT
 *                    
 *                  http://www.goXTK.com
 *                   
 * Copyright (c) 2012 The X Toolkit Developers <dev@goXTK.com>
 *                   
 *    The X Toolkit (XTK) is licensed under the MIT License:
 *      http://www.opensource.org/licenses/mit-license.php
 *
 * Dan's brain.
 *
 * The white/gray matter and CSF was automatically segmented - so it's not quite perfect.
 *
 */
-->

<html>
<head>
<title>Dan's brain</title>

<!-- <script type="text/javascript" src="http://get.goXTK.com/xtk_edge.js"></script> -->
<!-- <script type="text/javascript" src="../../X/lib/closure-library/closure/goog/base.js"></script> -->
<!-- <script type="text/javascript" src="../../X/xtk-deps.js"></script> -->
<script type="text/javascript" src="xtk.js"></script>
<script type="text/javascript" src="dat.gui.min.js"></script>

<script type="text/javascript">

  var run = function() {
    
    var r = new X.renderer('r');
    r.config.STATISTICS_ENABLED = true;
    r.config.PICKING_ENABLED = false;
    //r.config.ORDERING_ENABLED = false;
    r.init();
    
    var volume = new X.volume();
    volume.load('daniel.nrrd');
    

    
    var graymatter = new X.object();
    graymatter.load('daniel_gray_matter.vtk');
    graymatter.transform().flipX();
    graymatter.transform().rotateX(90);
    graymatter.transform().rotateY(180);
    graymatter.setOpacity(0.2);
    graymatter.setColor(0,0,1);

    var csf = new X.object();
    csf.load('daniel_csf.vtk');
    csf.transform().flipX();
    csf.transform().rotateX(90);
    csf.transform().rotateY(180);
    csf.setOpacity(0.7);
    csf.setColor(0.5,0.5,0.5);    
    
    r.add(volume);
    
    //r.camera().setUp(0,0,1);
    //r.camera().setPosition(60, 80, 250);
    r.render();
    
/*     r.onShowtime = function() {      
      
      volume.volumeRenderingOn();
      
      //
      // The GUI panel
      //
      // (we need to create this during onShowtime(..) since we do not know the volume
      // dimensions before the loading was completed)
      var gui = new dat.GUI();
      
      //
      // models gui
      //
      var modelsgui = gui.addFolder('Models');
      modelsgui.open();
      var wmgui = modelsgui.addFolder('White matter');
      var wmVisibleController = wmgui.add(whitematter,'_visible');
      var wmColorController = wmgui.addColor(whitematter, '_color');
      wmgui.open();
      
      var gmgui = modelsgui.addFolder('Gray matter');
      var gmVisibleController = gmgui.add(graymatter,'_visible');
      var gmOpacityController = gmgui.add(graymatter, '_opacity', 0, 1);
      var gmColorController = gmgui.addColor(graymatter, '_color');
      gmgui.open();
      
      var csfgui = modelsgui.addFolder('Cerebrospinal fluid');
      var csfVisibleController = csfgui.add(csf,'_visible');
      var csfOpacityController = csfgui.add(csf, '_opacity', 0, 1);
      var csfColorController = csfgui.addColor(csf, '_color');      
      csfgui.open();
      
      wmVisibleController.onChange(function(value) {
        r.render();
      });
      wmColorController.onChange(function(value) {
        r.render();
      });  

      gmVisibleController.onChange(function(value) {
        r.render();
      });
      gmOpacityController.onChange(function(value) {
        r.render();
      });      
      gmColorController.onChange(function(value) {
        r.render();
      });      

      csfVisibleController.onChange(function(value) {
        r.render();
      });
      csfOpacityController.onChange(function(value) {
        r.render();
      });      
      csfColorController.onChange(function(value) {
        r.render();
      });            
      
      // 
      // volume gui
      //
      var volumegui = gui.addFolder('Volume');
      var sliceXController = volumegui.add(volume, '_indexX', 0, volume
          .dimensions()[0] - 1);
      var sliceYController = volumegui.add(volume, '_indexY', 0, volume
          .dimensions()[1] - 1);
      var sliceZController = volumegui.add(volume, '_indexZ', 0, volume
          .dimensions()[2] - 1);
      volumegui.open();
      
      sliceXController.onChange(function(value) {

        volume.modified();
        r.render();
      });
      sliceYController.onChange(function(value) {

        volume.modified();
        r.render();
      });
      sliceZController.onChange(function(value) {

        volume.modified();
        r.render();
      });
      
    };
 */    
 

    r.onShowtime = function() {
      
      //
      // The GUI panel
      //
      // (we need to create this during onShowtime(..) since we do not know the volume
      // dimensions before the loading was completed)
      
      // a container to perform some actions
        var loader = {
          Load:function() {

            // also add a segmentation
				    var whitematter = new X.object();
				    whitematter.load('daniel_gray_matter.vtk');
				    whitematter.setColor(0.98, 0.98, 0.82);            
            
            r.onShowtime = function() {
              
              
              
            };
            
            r.add(whitematter);
            r.render();
            
            
          }
        };
      
      var gui = new dat.GUI();
      var volumegui = gui.addFolder('Volume');
      // ,, switch between slicing and volume rendering
      var vrController = volumegui.add(volume, '_volumeRendering');
      // .. configure the volume rendering opacity
      var opacityController = volumegui.add(volume, '_opacity', 0,1);
      // .. we can threshold
      var lowerThresholdController = volumegui.add(volume, '_lowerThreshold', volume.scalarRange()[0], volume.scalarRange()[1]);
      var upperThresholdController = volumegui.add(volume, '_upperThreshold', volume.scalarRange()[0], volume.scalarRange()[1]);
      var sliceXController = volumegui.add(volume, '_indexX', 0, volume.dimensions()[0]-1);
      var sliceYController = volumegui.add(volume, '_indexY', 0, volume.dimensions()[1]-1);
      var sliceZController = volumegui.add(volume, '_indexZ', 0, volume.dimensions()[2]-1);
      volumegui.open();
      var modelgui = gui.addFolder('Model');
      var addModelController = modelgui.add(loader,'Load');
      modelgui.open();
      
      //addModelController.onChange(func)
      
      vrController.onChange(function(value) {
        
        document.getElementById('r').style.backgroundColor = value ? '#000000' : '#ffffff';
        
        volume.modified();
        r.render();
      });
      
      opacityController.onChange(function(value){
        volume.modified();
        r.render();
      });     
      
      lowerThresholdController.onChange(function(value){
        volume.modified();
        r.render();
      });

      upperThresholdController.onChange(function(value){
        volume.modified();
        r.render();
      });     
      
      sliceXController.onChange(function(value) {
        volume.modified();
        r.render();
      });
      sliceYController.onChange(function(value) {
        volume.modified();
        r.render();
      });          
      sliceZController.onChange(function(value) {
        volume.modified();
        r.render();
      });              
      
    };
    


  };
</script>
<body onload="run()" style="margin: 0px;">

	<!-- the container for the renderer -->
	<div id="r"
		style="background-color: #ffffff; width: 100%; height: 100%;"></div>

</body>